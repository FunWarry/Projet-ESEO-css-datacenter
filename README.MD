[liens vers la documentation d'installation complette](http://20.86.62.213:3000/gevraima/Projet-ESEO/wiki/Guide_installation)

# Guide d'installation Complet du syst√®me - ESEO Teaching Cloud

## I. Guide d'installation d'OPNSense

### Pr√©requis :

* Un ordinateur avec :
    * \> 4 c≈ìurs
    * \> 8 Go de RAM
    * \> 40 Go d'espace libre
    * 2 cartes Ethernet
    * Une connexion vers le routeur de l'ESEO
    * Une connexion vers le switch de votre LAN

### Obtention de l'ISO OPNSense :

1.  Allez sur [opnsense.org/downloads](https://opnsense.org/downloads)
2.  S√©lectionnez l'image DVD.
3.  Apr√®s le t√©l√©chargement, lancez la commande `bzip2 -d OPNsense-<nomdefichier>.bz2` en ajustant `<nomdefichier>` avec le nom du fichier t√©l√©charg√©.

### Mise en place de VirtualBox :

4.  Sur VirtualBox, cr√©ez une nouvelle machine FreeBSD (64-bit) en s√©lectionnant l'ISO d√©compress√© pr√©c√©demment.
5.  Dans l'onglet "Hardware", mettez au minimum 2 Go de RAM et 2 c≈ìurs de CPU. Si possible, utilisez 8 Go et 4 c≈ìurs.
6.  Dans l'onglet "Hard Disk", mettez au minimum 40 Go. Si possible, utilisez 120 Go.
7.  Cliquez sur "Finish".
8.  Dans le menu principal de VirtualBox, cliquez sur "Configuration".
9.  Donnez deux interfaces bridge √† OPNSense pour chaque interface r√©seau : une pour le LAN (enp1s0) et l'autre pour le WAN (eno1).

### Installation d'OPNSense :

10. Lancez la machine virtuelle.
11. L'invite de commande peut vous demander d'assigner des interfaces. WAN doit √™tre l'interface connect√©e √† l'ext√©rieur de votre r√©seau, et LAN celle connect√©e √† l'int√©rieur.
12. Attendez que l'invite vous demande un mot de passe.
13. Entrez le mot de passe "installer".
14. Vous devriez voir un menu pour choisir la disposition du clavier. Utilisez la fl√®che du bas pour s√©lectionner "French", puis validez avec Tab et "Continue".
15. Dans le menu suivant, choisissez "ZFS".
16. S√©lectionnez le disque.
17. Confirmez que vous voulez continuer avec le swap de la taille recommand√©e.
18. Confirmez que vous voulez effacer le contenu du disque.

Le logiciel va maintenant installer OPNSense. Cela peut prendre un certain temps.

19. L'interface vous donnera deux options : changer le mot de passe ou continuer l'installation. Choisissez "Continue". Le mot de passe pourra √™tre modifi√© plus tard.
20. Apr√®s le red√©marrage, √©teignez la machine en tapant "5" dans l'invite de commande.
21. Allez dans les param√®tres de la machine sur VirtualBox, et dans l'onglet "Storage", retirez le disque ISO.
22. Relancez la machine virtuelle.
23. Depuis votre r√©seau, acc√©dez √† l'interface web √† l'adresse indiqu√©e dans l'invite de commande.
24. Connectez-vous avec le mot de passe que vous avez choisi.
25. Allez dans `System -> Firmware -> Status`.

### Fichier de Configuration OPNSense
Le fichier de configuration OPNSense se trouve dans le dossier "Configuration Opnsense". Pour importer cette configuration :
1.  Se connecter √† l'interface web d'OPNSense.
2.  Aller dans `System` -> `Configuration` -> `Backup / Restore`.
3.  Choisir l'option "Restore Configuration".
4.  S√©lectionner le fichier de configuration √† importer.
5.  Cliquer sur "Restore".
6.  Red√©marrer le syst√®me.


## II. Guide d'installation du r√©seau

Ce guide d√©crit les √©tapes √† suivre pour installer et configurer la partie r√©seau de votre syst√®me, en utilisant les scripts de configuration du routeur et du switch, ainsi que le sch√©ma de branchement r√©seau.

### 1. Pr√©requis

Avant de commencer, assurez-vous d'avoir les √©l√©ments suivants :

* Les scripts de configuration du routeur et du switch.
* Le sch√©ma de branchement r√©seau.
* Les √©quipements r√©seau (routeur, switch, c√¢bles Ethernet).
* Un ordinateur avec une interface r√©seau et un logiciel de terminal (par exemple, PuTTY).

### 2. √âtapes d'installation

1.  **Branchement des √©quipements :**

	![Description de l'image](http://20.86.62.213:3000/gevraima/Projet-ESEO/raw/commit/b74c1875816d3d1f7da28785210a8f82089c980d/plan%20de%20branchement.png)
    
    * Suivez le sch√©ma de branchement r√©seau pour connecter les √©quipements entre eux √† l'aide des c√¢bles Ethernet.
    * Assurez-vous que tous les √©quipements sont correctement aliment√©s.

2.  **Configuration du routeur :**

    * Connectez votre ordinateur au routeur √† l'aide d'un c√¢ble serial.
    * Ouvrez un logiciel de terminal et configurez la connexion avec les param√®tres suivants :
        * Type de connexion : S√©rie (ou Telnet si le routeur est configur√© pour le permettre)
        * D√©bit en bauds : 9600 (ou autre valeur sp√©cifi√©e par le fabricant)
        * Bits de donn√©es : 8
        * Parit√© : Aucune
        * Bits d'arr√™t : 1
        * Contr√¥le de flux : Aucun
    * Mettez le routeur sous tension et attendez qu'il d√©marre.
    * Copiez et collez le script de configuration du routeur dans le terminal (clique droit pour coller sur une console putty).
    * Enregistrez la configuration en tapant sur "entrer" pour la commande `copy running-config startup-config`.

3.  **Configuration du switch :**

    * Connectez votre ordinateur au switch √† l'aide d'un c√¢ble serial.
    * Ouvrez un logiciel de terminal et configurez la connexion de la m√™me mani√®re que pour le routeur.
    * Mettez le switch sous tension et attendez qu'il d√©marre.
    * Copiez et collez le script de configuration du switch dans le terminal (clique droit pour coller sur une console putty).
    * Enregistrez la configuration en tapant sur "entrer" pour la commande `copy running-config startup-config`.

4.  **V√©rification de la connectivit√© :**

    * Une fois les configurations du routeur et du switch termin√©es, v√©rifiez la connectivit√© entre les diff√©rents √©quipements.
    * Utilisez la commande `ping` sur votre ordinateur pour tester la connectivit√© avec le routeur, le switch et les autres √©quipements du r√©seau.
    * Si la connectivit√© n'est pas √©tablie, v√©rifiez les branchements, les configurations et les adresses IP.



### 3. Scripts de configuration

[Script du routeur](http://20.86.62.213:3000/gevraima/Projet-ESEO/src/branch/r√©seau/script%20routeur%20projet.txt)

[Script du switch](http://20.86.62.213:3000/gevraima/Projet-ESEO/src/branch/r√©seau/script%20switch%20projet.txt)

Se trouve dans le dossier "scripte r√©seau" pour le rendu Incr√©ment 1.

---

## III. Guide d'installation des VMs : Ansible Master - Projet ESEO
Ce dossier met en place une machine virtuelle nomm√©e `ansibleMaster` √† l'aide de **Vagrant** et **VirtualBox**, destin√©e √† l'automatisation du d√©ploiement de services via **Ansible**.

### Structure du Dossier

```
ansibleMaster/
‚îú‚îÄ‚îÄ ansible/         # Contient les playbooks, inventaires et r√¥les Ansible
‚îú‚îÄ‚îÄ logs/            # Dossier pour stocker les journaux d‚Äôex√©cution
‚îú‚îÄ‚îÄ scripts/         # Scripts shell utilis√©s pour la configuration syst√®me
‚îú‚îÄ‚îÄ Vagrantfile      # Fichier de configuration Vagrant

````

### Description du `Vagrantfile`

- **Box utilis√©e** : `chavinje/fr-book-64`
- **Nom de la VM** : `ansibleMaster`
- **Adresse IP publique** : `192.168.238.13`
- **Ressources** :
  - CPU : 2 c≈ìurs
  - RAM : 2048 Mo

### Provisioning

Au d√©marrage, la VM est configur√©e automatiquement avec :

- Activation de l‚Äôauthentification SSH par mot de passe
- Configuration r√©seau statique (`192.168.238.13/29`)
- Red√©finition de la passerelle par d√©faut (`192.168.238.9`)
- Configuration du DNS (`192.168.4.2`)
- Ex√©cution de deux scripts :
  - `scripts/config_sys.sh` : configuration syst√®me en cr√©√©ant l'utilisateurs ansible et un alias master pour contr√¥ler l'infra 
  - `scripts/send_keys.sh` : d√©ploiement de cl√©s vers les hotes (Firewall, DNS, Web, Bdd, Supervision, Sauvegarde).

### Lancement du projet

1. **Pr√©requis** :
   - [Vagrant](https://www.vagrantup.com/downloads)
   - [VirtualBox](https://www.virtualbox.org/wiki/Downloads)

2. **D√©marrage** :

   Depuis le dossier `ansibleMaster` :

```bash
vagrant up
````

Cela t√©l√©charge l‚Äôimage, cr√©e la VM, configure le r√©seau et ex√©cute les scripts.

3. **Connexion √† la VM** :

```bash
vagrant ssh ansibleMaster
```
4. **Contr√¥le des serveurs physique** :
Se connecter avec l'utilisateur ansible qui a pour mot de passe N3twork! et ex√©cuter

```bash
master
```

# Ancienne version





























### 1. D√©ploiement d'un Cluster Galera avec HAProxy via Vagrant  

Permet de d√©ployer **automatiquement un cluster Galera** pour le gestionnaire de base de donn√©es **MariaDB**, accompagn√© d'un **load balancer HAProxy**. L'installation et la configuration sont r√©alis√©es √† l‚Äôaide de **Vagrant** et de plusieurs scripts bash.  

#### Qu'est-ce que Galera ?  

**Galera Cluster** est une solution de **r√©plication synchrone** pour MariaDB qui permet de :  

- [x] Assurer la haute disponibilit√© des bases de donn√©es.  
- [x] R√©pliquer les donn√©es en **temps r√©el** entre plusieurs n≈ìuds.
- [x] Offrir une **tol√©rance aux pannes** en cas de d√©faillance d‚Äôun serveur.
- [x] Permettre un **scaling horizontal** en r√©partissant la charge sur plusieurs serveurs.  

Dans ce projet, **trois machines** seront configur√©es pour former un **cluster Galera**, avec un **HAProxy** en guise de load balancer pour g√©rer les connexions de mani√®re √©quilibr√©e.  

#### D√©ploiement Automatis√©  

**Pr√©-requis :**  
- **Vagrant** et **VirtualBox** doivent √™tre install√©s avant de lancer le script.  

Le **Vagrantfile** est con√ßu pour **d√©ployer 4 machines** et ex√©cuter automatiquement les scripts suivants :  

1. `script_host` (variable dans le Vagrantfile)  
Associe un **nom d‚Äôh√¥te** √† chaque machine en mettant √† jour le fichier `/etc/hosts` :  
```sh
echo '192.168.234.3 galeranode1' >> /etc/hosts
echo '192.168.234.4 galeranode2' >> /etc/hosts
echo '192.168.234.5 galeranode3' >> /etc/hosts
echo '192.168.234.6 haproxynode1' >> /etc/hosts
```  

2. `script_ssh` (variable dans le Vagrantfile)  
Active la **connexion SSH** avec authentification pour chaque machine.  

3. `config_sys.sh` (script Bash dans `scripts/`)  
Configure l‚Äôinterface r√©seau **enp0s8** avec le bon **masque** en fonction de la machine.  

4. `script_route` (variable dans le Vagrantfile)  
Supprime la **route NAT par d√©faut** et la remplace par la **passerelle appropri√©e**.  

5. `install_galera.sh` (script Bash dans `scripts/`)  
Installe et configure **Galera Cluster** sur les **trois machines Galera** :  
D√©ploie **MariaDB** et **Galera** sur chaque n≈ìud.  
Initialise le **cluster Galera** sur `galeranode1`.  
Cr√©e **deux utilisateurs** (`etudiant1`, `etudiant2`).  
Cr√©e **deux bases de donn√©es** (`etudiant1`, `etudiant2`).  

6. `install_ha.sh` (script Bash dans `scripts/`)  
Installe et configure **HAProxy** sur `haproxynode1` :  
D√©ploie un **load balancer** pour distribuer la charge entre les n≈ìuds Galera.  
Facilite l‚Äôacc√®s aux bases de donn√©es en redirigeant les connexions automatiquement.  

---

#### Lancer le d√©ploiement  

***A faire dans le r√©pertoire o√π se situe le vagrantfile pour le d√©ploiment des vms galera***

Pour **d√©marrer** toutes les machines et ex√©cuter les scripts automatiquement :  
```sh
vagrant up
```  

---

#### Remarques  

- Les configurations peuvent √™tre personnalis√©es en modifiant les fichiers de configuration MariaDB et HAProxy.  

**Pourquoi utiliser HAProxy ?**  
HAProxy assure une **r√©partition √©quilibr√©e** des connexions aux bases de donn√©es et am√©liore la **disponibilit√©** du cluster.  

**O√π voir les logs ?**  
- Logs MariaDB/Galera : `/var/log/mysql/error.log`  
- Logs HAProxy : `/var/log/haproxy.log`  

---

#### R√©f√©rences  

üîó [Documentation Galera Cluster](https://www.it-connect.fr/comment-mettre-en-place-mariadb-galera-cluster-sur-debian-11/)  
üîó [Documentation HAProxy](https://www.haproxy.com/blog/haproxy-configuration-basics-load-balance-your-servers)  

---

### 2. D√©ploiement d'un Serveur DNS - Projet ESEO Teaching Cloud  

Permet de d√©ployer automatiquement une machine virtuelle qui servira de **serveur DNS** au sein d‚Äôun r√©seau. L‚Äôinstallation et la configuration sont r√©alis√©es √† l‚Äôaide de **Vagrant** et de plusieurs scripts bash.  

#### Pourquoi un serveur DNS ?  

Un **serveur DNS (Domain Name System)** est un √©l√©ment cl√© dans un r√©seau. Il permet de **traduire les noms de domaine en adresses IP**, facilitant ainsi l'acc√®s aux services sans avoir √† retenir des adresses num√©riques complexes.  

Dans ce projet, nous allons configurer un serveur DNS nomm√© **srv-dns.dns.local** en utilisant **BIND9**, un serveur DNS largement utilis√©.  

#### D√©ploiement Automatis√©  

Le d√©ploiement repose sur un fichier **Vagrantfile** qui configure la machine et ex√©cute automatiquement les scripts suivants :  

1. **script_ssh** (variable dans le Vagrantfile)  
   - Active l‚Äôauthentification SSH pour permettre la connexion s√©curis√©e √† la machine.  

2. **install_bind.sh** (script Bash dans `scripts/`)  
   - Installe et configure **BIND9** pour transformer la machine en un **serveur DNS nomm√© srv-dns.dns.local**.
   
3. **config_sys.sh** (script Bash dans `scripts/`)  
   - Configure l‚Äôinterface r√©seau **enp0s8** avec le bon masque en fonction de la machine.  

4. **script_route** (variable dans le Vagrantfile)  
   - Supprime la route NAT par d√©faut et la remplace par la **passerelle appropri√©e** pour assurer une bonne connectivit√©.  
 

#### Lancer le d√©ploiement  

***A faire dans le r√©pertoire o√π se situe le vagrantfile pour le d√©ploiment des de la VM DNS***

Pour d√©ployer la machine, il suffit d‚Äôex√©cuter :  

```bash
vagrant up
```

Cela cr√©era et configurera automatiquement le serveur DNS.  


#### Remarque  

- Vous pouvez personnaliser la configuration DNS en modifiant le fichier de configuration de **BIND9** apr√®s l‚Äôinstallation.

---

### 3. D√©ploiement des Machines √âtudiants

Ce projet utilise **Vagrant** pour d√©ployer deux machines virtuelles, **etudiant1** et **etudiant2**. Lors du d√©ploiement, quatre scripts seront ex√©cut√©s afin de configurer les machines, d√©finir les param√®tres r√©seau, et d'installer un serveur web avec du contenu sp√©cifique sur chaque machine.

#### Structure
```
.
‚îú‚îÄ‚îÄ Vagrantfile
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ config_sys.sh
‚îÇ   ‚îú‚îÄ‚îÄ install_web.sh
```

#### D√©ploiement

***A faire dans le r√©pertoire o√π se situe le vagrantfile pour le d√©ploiment des vms etudiant***

Pour d√©ployer les machines, ex√©cutez simplement la commande suivante :
```bash
vagrant up
```
Cela cr√©era et configurera les machines virtuelles avec les param√®tres d√©finis.

#### Scripts d√©ploy√©s
Quatre scripts principaux sont ex√©cut√©s lors du d√©ploiement :

1. **Activation de la connexion SSH** (`script_ssh`)
Ce script, d√©fini sous forme de variable dans le `Vagrantfile`, active la connexion SSH avec authentification pour les machines virtuelles.

2. **Configuration r√©seau** (`config_sys.sh`)
- Localis√© dans le r√©pertoire `scripts/`
- Configure l'interface **bridge** (`enp0s8`) avec le bon masque r√©seau en fonction de la machine.

3. **Gestion des routes** (`script_route`)
- D√©fini sous forme de variable dans le `Vagrantfile`
- Supprime la route NAT par d√©faut et la remplace par la passerelle par d√©faut du serveur concern√©.

4. **Installation du serveur web** (`install_web.sh`)
- Localis√© dans le r√©pertoire `scripts/`
- D√©ploie un serveur web sur chaque machine et configure le contenu :
  - **etudiant1** : Installe **phpMyAdmin** et le met √† disposition sur le port **80**
  - **etudiant2** : D√©ploie une page HTML simple sur le port **80**

#### Acc√®s aux Machines
Une fois le d√©ploiement termin√©, vous pouvez acc√©der aux machines via SSH :
```bash
vagrant ssh etudiant1
vagrant ssh etudiant2
```
Ou visiter les sites d√©ploy√©s dans un navigateur :
- **etudiant1** : [http://192.168.232.3] (phpMyAdmin)
- **etudiant2** : [http://192.168.232.4] (Page HTML)

---

### 4. D√©ploiement de la Machine Zabbix server

Ce projet utilise **Vagrant** pour d√©ployer deux machines virtuelles, **etudiant1** et **etudiant2**. Lors du d√©ploiement, quatre scripts seront ex√©cut√©s afin de configurer les machines, d√©finir les param√®tres r√©seau, et d'installer un serveur web avec du contenu sp√©cifique sur chaque machine.

#### D√©ploiement

***A faire dans le r√©pertoire o√π se situe le vagrantfile pour le d√©ploiment de la VM serveur Zabbix***

Pour d√©ployer les machines, ex√©cutez simplement la commande suivante :
```bash
vagrant up
```
Cela cr√©era et configurera les machines virtuelles avec les param√®tres d√©finis.

#### Acc√®s aux Machines

Une fois l'installation termin√©e, acc√©dez √† l'interface web √† l'adresse:
```
http://adresse-ip-serveur/zabbix
```

Identifiants par d√©faut:
- Utilisateur: Admin
- Mot de passe: zabbix

#### Notes importantes

- Remplacez 'password' par un mot de passe s√©curis√©
- Modifiez le mot de passe par d√©faut apr√®s la premi√®re connexion
- V√©rifiez les logs en cas de probl√®me dans `/var/log/zabbix/`

#### Liens utiles

- [Documentation officielle Zabbix](https://www.zabbix.com/documentation/)

---
